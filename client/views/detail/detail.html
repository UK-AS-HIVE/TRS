<template name="detail">
  <div class="row">
    <div class="span4">
      <h1>{{department}}</h1>
      <h2>{{semester}}</h2>
    </div>
    <div class="span8">
      <div class="inline-edit" id="comments-{{_id}}">
        Comments:
        <span class="inline-edit-preview">{{{data.comments}}}</span>
        <span class="inline-edit-form">
          <br/>
          <textarea id="comments-textarea" placeholder="Comments">{{{data.comments}}}</textarea>
        </span>
        <i class="icon-edit"></i>
      </div>
      <div class="inline-edit" id="approved-funding-{{_id}}">
        Approved funding:
        <span class="inline-edit-preview">{{data.funding}}</span>
        <span class="inline-edit-form">
          <input id="approved-funding-input" type="text" value="{{data.funding}}" placeholder="Approved funding" />
        </span>
        <i class="icon-edit"></i>
      </div>
      <div id="currently-allocated">
        {{#isolate}}
        Currently allocated: {{currentlyAllocated ''}}
        <i id="currentlyallocatedbtn" class="icon-plus"></i>
        {{#if currentlyAllocatedIsExpanded}}
	  <div id="currentlyallocatedexpansion"> 
            <table class="table table-striped">
              <thead>
                <tr><td>Rank</td><td>Allocated/Budgeted</td><td>Filled/Alloted Lines</td><td>Rate<td></tr>
              </thead>
              <tbody>
		{{#each key_value data.breakdown}}
		  <tr class="inline-edit deletable breakdown" id="breakdown-{{../data._id}}-{{key}}" data-id="{{../data._id}}" data-index="{{key}}" >
		    <td>
		      <span class="inline-edit-preview">{{value.rank}}</span>
		      <span class="inline-edit-form"><input type="text" value="{{value.rank}}" data-property="rank" data-id="{{../data._id}}" data-index="{{key}}" /></span>
		      <i class="icon-trash pull-right"></i>
		      <i class="icon-edit pull-right"></i>
		    </td>
		    <td>
		      {{currentlyAllocated value.rank semester=../semester department=../department}}
		    </td>
		    <td>
		      <span class="inline-edit-preview">{{value.lines}}</span>
		      <span class="inline-edit-form"><input type="text" value="{{value.lines}}" data-property="lines" data-id="{{../data._id}}" data-index="{{key}}" /></span>
		    </td>
		    <td>
		      <span class="inline-edit-preview">{{value.rate}}</span>
		      <span class="inline-edit-form"><input type="text" value="{{value.rate}}" data-property="rate" data-id="{{../data._id}}" data-index="{{key}}" /></span>
		    </td>
		  </tr>
		{{/each}}
		<tr>
		  <td colspan="4">
		    <button class="btn btn-primary btn-mini" id="add-rank-type">Add...</button>
		  </td>
		</tr>
              </tbody>
            </table>
	  </div>      
        {{/if}}
        {{/isolate}}
      </div>
    </div>
  </div>

  <table id="people" class="table table-striped table-bordered">
    <thead>
      <th id="person-info">Person</th>
      <th id="pay-amount">Pay Amount</th>
      <th id="courses">Courses</th>
    </thead>
    <tbody>
      {{#each persons}}
        <tr>
          <td class="instructor-details deletable inline-edit" id="instructor-details-{{_id}}" {{{inlineEditBackground prefix='instructor-details-' bgcolor='lightgray'}}}>
            <i class="icon-trash pull-right"></i>
            <i class="icon-edit pull-right"></i>

            {{#isolate}}
            {{inlineEditLock prefix='instructor-details-'}}
            {{/isolate}}

            <span class="inline-edit-preview">  
              <h4 class="name field">{{name}}</h4>
              {{#if rank}}
              <div class="rank field">
                <span class="label">Rank</span>
                <span class="value">{{rank}}</span>
              </div>
              {{/if}}
              {{#if ukid}}
              <div class="ukid field">
                <span class="label">UKID</span>
                <span class="value">{{ukid}}</span>
              </div>
              {{/if}}
              {{#if notes}}
              <div class="notes field">
                <span class="label">Notes</span>
                <span class="value">{{notes}}</span>
              </div>
              {{/if}}
            </span>

            <span id="person-{{ _id }}" class="inline-edit-form">
              <div class="instructor-properties">
                <div class="field name">
                  <label for="name" class="label">Name</label>
                  <input type="text" name="name" data-property="name" value="{{name}}" />
                </div>
                {{> detailRankSelect }}
                <div class="field ukid">
                  <label for="ukid" class="label">UKID</label>
                  <input type="text" name="ukid" data-property="ukid" value="{{ukid}}" />
                </div>
                <div class="field notes">
                  <label for="notes" class="label">Notes</label>
                  <input type="text" name="notes" data-property="notes" value="{{notes}}" />
                </div>

              </div>
            </span>
          </td>

          <td class="pay-amount deletable inline-edit" id="pay-amount-{{_id}}" {{{inlineEditBackground prefix='pay-amount-' bgcolor='lightgray'}}}>
            <i class="icon-edit pull-right"></i>
            {{#isolate}}
              {{inlineEditLock prefix='pay-amount-'}}
            {{/isolate}}

            <span class="inline-edit-preview">  
              {{pay_amount}}
            </span>

            <span id="pay-amount-{{_id}}" class="inline-edit-form">
              {{#if isGradStudent}}
              {{#each lineTypes}}
              <div class="field lines">
                <label for="lines{{this.rank}}" class="label">{{this.rank}} lines</label>
                <input type="text" name="lines{{this.rank}}" maxlength="4" value="{{lineValue .. this.rank}}" data-property="lines.{{this.rank}}" data-id="{{../_id}}" /> * {{this.rate}}
              </div>
              {{/each}}
              {{/if}}
              
              {{#unless isGradStudent}}
                <div class="field buyout">
                  <label for="buyout" class="label">Buyout</label>
                  <!--<input type="text" name="buyout" data-property="buyout" value="{{buyout}}" />-->
                  <input type="checkbox" name="buyout" data-property="buyout" {{{checked buyout}}} />
                  <input type="text" name="buyoutAmount" data-property="buyoutAmount" {{{disabled buyout}}} />
                </div>
              {{/unless}}

              <div class="field pay-amount">
                <label for="pay_amount" class="label">Pay Amount</label>
                <input type="text" name="pay_amount" data-property="pay_amount" value="{{pay_amount}}" />
              </div>
            </span>
          </td>

          <td class="instructor-courses">
            <button name="add-course" class="add-course btn btn-mini pull-right">
              Add course
            </button>
            <ul>
              {{#each key_value courses}}
                <li id="course-{{../_id}}-{{key}}" data-index="{{key}}" data-id="{{../_id}}" class="course deletable inline-edit">
                  <span class="inline-edit-preview">
                    {{value.prefix}}-{{value.number}}
                    ({{value.credits}} credits{{#if value.sections}}, sections {{value.sections}}{{/if}})
                  </span>
                  <span class="inline-edit-form" data-index="{{key}}" data-id="{{../_id}}">
                    <div class="prefix field">
                      <input type="text" placeholder="Prefix" maxlength="4" value="{{value.prefix}}" name="prefix" />
                      <label for="prefix">Prefix</label>
                    </div>
                    <div class="number field">
                      <input type="text" placeholder="Course number" maxlength="4" value="{{value.number}}" name="number" />
                      <label for="number">Number</label>
                    </div>
                    <div class="credits field">
                      <input type="number" placeholder="Credit hours" min="0" max="4" maxlength="1" value="{{value.credits}}" name="credits" />
                      <label for="credits">Hours</label>
                    </div>
                    <div class="sections field">
                      <input type="text" placeholder="Sections" value="{{value.sections}}" name="sections" />
                      <label for="sections">Sections</label>
                    </div>
                  </span>
                  <i class="icon-edit"></i>
                  <i class="icon-trash"></i>
                </li>
              {{/each}}
            </ul>
          </td>          
        </tr>
      {{/each}}
      <tr>
        <td colspan="3">
          <button class="btn btn-primary pull-right" id="add">Add...</button>
        </td>
      </tr>
    </tbody>
  </table>
</template>

<template name="detailRankSelect">
  <div class="field rank">
    <label for="rank" class="label">Rank</label>
    <select name="rank" class="rank" style="min-width: 35%">
      <optgroup label="Faculty">
        <option {{selectedOption 'Full'}}>Full Professor</option>
        <option {{selectedOption 'Professor'}}>Professor</option>
        <option {{selectedOption 'Assoc'}}>Associate Professor</option>
        <option {{selectedOption 'Assist'}}>Assistant Professor</option>
      </optgroup>
      <option {{selectedOption 'Lecturer'}}>Lecturer</option>
      <option {{selectedOption 'PostDoc'}}>Post Doc</option>
      <option {{selectedOption 'FTI'}}>FTI</option>
      <option {{selectedOption 'PTI'}}>PTI</option>
      <optgroup label="Grad Student">
	<option {{selectedOption 'GA'}}>GA</option>
	<option {{selectedOption 'RA'}}>RA</option>
	<option {{selectedOption 'TA'}}>TA</option>
      </optgroup>
    </select>
  </div>
</template>
